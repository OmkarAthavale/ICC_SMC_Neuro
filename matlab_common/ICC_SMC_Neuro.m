
function [VOI, STATES, ALGEBRAIC, CONSTANTS] = ICC_SMC_Neuro(e, w, x_e, x_i, duration)
   % Solves the combined ICC and SMC model with neurotransmission
   % INPUTS
   % e: 1 x 5 array of effector component weighting values in sequence
   %    [kiAno1, kiNSCC, kiCa50, kiSK, keIP3]. Only keIP3 may  e > 1. All
   %    must be > 0.
   % w: 1 x 3 array of weighting parameter values in sequence 
   %    [piICC, piSMC, pe]. Should not be zero. 
   % x_e: excitatory stimulation dosage in domain [0, 1]
   % x_i: inhibitory stimulation dosage in domain [0, 1]
   % duration (OPTIONAL): two element array of start and end time for
   %                      ode15s solver. Default [0 180000].
   %
   % OUTPUTS
   % VOI: n x 1 array with variable of integration for n steps (time in 
   %      milliseconds)
   % STATES: n x m array with state variable values at n steps for m (31)
   %         variables (see create legends function for variable sequence and units)
   % ALGEBRAIC: n x o array with algebraic variable values at n steps for o
   %            (82) variables (see create legends function for variable sequence and units)
   % CONSTANTS: 1 x p array with constant variable values for p (199)
   %            variables (see create legends function for variable sequence and units)
   if nargin < 5
        duration = [0 180000];
    end
   [VOI, STATES, ALGEBRAIC, CONSTANTS] = solveModel(e, w, x_e, x_i, duration);
end

function [algebraicVariableCount] = getAlgebraicVariableCount()
    % Used later when setting a global variable with the number of algebraic variables.
    % Note: This is not the "main method".
    algebraicVariableCount =82;
end
% There are a total of 31 entries in each of the rate and state variable arrays.
% There are a total of 199 entries in the constant variable array.
%

function [VOI, STATES, ALGEBRAIC, CONSTANTS] = solveModel(e, w, x_e, x_i, duration)
    % Create ALGEBRAIC of correct size
    global algebraicVariableCount;  algebraicVariableCount = getAlgebraicVariableCount();
    % Initialise constants and state variables
    [INIT_STATES, CONSTANTS] = initConsts(e, w, x_e, x_i);

    % Set timespan to solve over
    tspan = duration;

    % Set numerical accuracy options for ODE solver
    options = odeset('RelTol', 1e-06, 'AbsTol', 1e-06, 'MaxStep', 1);

    % Solve model with ODE solver
    [VOI, STATES] = ode15s(@(VOI, STATES)computeRates(VOI, STATES, CONSTANTS), tspan, INIT_STATES, options);

    % Compute algebraic variables
    [RATES, ALGEBRAIC] = computeRates(VOI, STATES, CONSTANTS);
    ALGEBRAIC = computeAlgebraic(ALGEBRAIC, CONSTANTS, STATES, VOI);

    % Plot state variables against variable of integration
    [LEGEND_STATES, LEGEND_ALGEBRAIC, LEGEND_VOI, LEGEND_CONSTANTS] = createLegends();
    figure();
    plot(VOI, STATES);
    xlabel(LEGEND_VOI);
    l = legend(LEGEND_STATES);
    set(l,'Interpreter','none');
end

function [LEGEND_STATES, LEGEND_ALGEBRAIC, LEGEND_VOI, LEGEND_CONSTANTS] = createLegends()
    LEGEND_STATES = ''; LEGEND_ALGEBRAIC = ''; LEGEND_VOI = ''; LEGEND_CONSTANTS = '';
    LEGEND_VOI = strpad('time in component Time (time_units)');
    LEGEND_CONSTANTS(:,1) = strpad('T in component Environment (Temperature_units)');
    LEGEND_CONSTANTS(:,2) = strpad('T_exp in component Environment (Temperature_units)');
    LEGEND_CONSTANTS(:,3) = strpad('F in component Environment (F_units)');
    LEGEND_CONSTANTS(:,4) = strpad('R in component Environment (R_units)');
    LEGEND_CONSTANTS(:,5) = strpad('Q10Ca in component Environment (dimensionless)');
    LEGEND_CONSTANTS(:,6) = strpad('Q10K in component Environment (dimensionless)');
    LEGEND_CONSTANTS(:,7) = strpad('Q10Na in component Environment (dimensionless)');
    LEGEND_CONSTANTS(:,8) = strpad('Ca_o in component Environment (millimolar)');
    LEGEND_CONSTANTS(:,9) = strpad('Na_o in component Environment (millimolar)');
    LEGEND_CONSTANTS(:,10) = strpad('K_o in component Environment (millimolar)');
    LEGEND_CONSTANTS(:,11) = strpad('Cl_o in component Environment (millimolar)');
    LEGEND_CONSTANTS(:,159) = strpad('T_correction_Na in component Environment (dimensionless)');
    LEGEND_CONSTANTS(:,160) = strpad('T_correction_K in component Environment (dimensionless)');
    LEGEND_CONSTANTS(:,161) = strpad('T_correction_Ca in component Environment (dimensionless)');
    LEGEND_CONSTANTS(:,162) = strpad('T_correction_BK in component Environment (conductance_units)');
    LEGEND_CONSTANTS(:,163) = strpad('FoRT in component Environment (Inverse_Voltage_units)');
    LEGEND_CONSTANTS(:,164) = strpad('RToF in component Environment (voltage_units)');
    LEGEND_CONSTANTS(:,12) = strpad('Cm_SM in component SM_Membrane (capacitance_units)');
    LEGEND_CONSTANTS(:,13) = strpad('Vol_SM in component SM_Membrane (volume_units)');
    LEGEND_STATES(:,1) = strpad('Vm_SM in component SM_Membrane (voltage_units)');
    LEGEND_STATES(:,2) = strpad('Ca_i in component SM_Membrane (millimolar)');
    LEGEND_CONSTANTS(:,14) = strpad('Na_i in component SM_Membrane (millimolar)');
    LEGEND_CONSTANTS(:,15) = strpad('K_i in component SM_Membrane (millimolar)');
    LEGEND_ALGEBRAIC(:,58) = strpad('I_Na_SM in component I_Na_SM (current_units)');
    LEGEND_ALGEBRAIC(:,40) = strpad('I_Ltype_SM in component I_Ltype_SM (current_units)');
    LEGEND_ALGEBRAIC(:,46) = strpad('I_LVA_SM in component I_LVA_SM (current_units)');
    LEGEND_ALGEBRAIC(:,56) = strpad('I_kr_SM in component I_kr_SM (current_units)');
    LEGEND_ALGEBRAIC(:,60) = strpad('I_ka_SM in component I_ka_SM (current_units)');
    LEGEND_ALGEBRAIC(:,50) = strpad('I_BK_SM in component I_BK_SM (current_units)');
    LEGEND_CONSTANTS(:,178) = strpad('S_iSK in component neural_input (dimensionless)');
    LEGEND_ALGEBRAIC(:,52) = strpad('I_SK_SM in component I_SK_SM (current_units)');
    LEGEND_ALGEBRAIC(:,65) = strpad('I_NSCC_SM in component I_NSCC_SM (current_units)');
    LEGEND_ALGEBRAIC(:,54) = strpad('I_bk_SM in component I_bk_SM (current_units)');
    LEGEND_ALGEBRAIC(:,42) = strpad('J_CaSR_SM in component J_CaSR_SM (millimolar_per_millisecond)');
    LEGEND_ALGEBRAIC(:,1) = strpad('I_couple in component I_couple (current_units)');
    LEGEND_CONSTANTS(:,16) = strpad('g_couple in component I_couple (conductance_units)');
    LEGEND_STATES(:,3) = strpad('Vm in component ICC_Membrane (voltage_units)');
    LEGEND_ALGEBRAIC(:,2) = strpad('d_inf_Ltype_SM in component d_Ltype_SM (dimensionless)');
    LEGEND_CONSTANTS(:,179) = strpad('tau_d_Ltype_SM in component d_Ltype_SM (time_units)');
    LEGEND_STATES(:,4) = strpad('d_Ltype_SM in component d_Ltype_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,3) = strpad('f_inf_Ltype_SM in component f_Ltype_SM (dimensionless)');
    LEGEND_CONSTANTS(:,180) = strpad('tau_f_Ltype_SM in component f_Ltype_SM (time_units)');
    LEGEND_STATES(:,5) = strpad('f_Ltype_SM in component f_Ltype_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,4) = strpad('f_ca_inf_Ltype_SM in component f_ca_Ltype_SM (dimensionless)');
    LEGEND_CONSTANTS(:,181) = strpad('tau_f_ca_Ltype_SM in component f_ca_Ltype_SM (time_units)');
    LEGEND_STATES(:,6) = strpad('f_ca_Ltype_SM in component f_ca_Ltype_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,29) = strpad('E_Ca in component I_Ltype_SM (voltage_units)');
    LEGEND_CONSTANTS(:,17) = strpad('G_max_Ltype in component I_Ltype_SM (conductance_units)');
    LEGEND_CONSTANTS(:,18) = strpad('J_max_CaSR in component J_CaSR_SM (millimolar_per_millisecond)');
    LEGEND_ALGEBRAIC(:,5) = strpad('d_inf_LVA_SM in component d_LVA_SM (dimensionless)');
    LEGEND_CONSTANTS(:,182) = strpad('tau_d_LVA_SM in component d_LVA_SM (time_units)');
    LEGEND_STATES(:,7) = strpad('d_LVA_SM in component d_LVA_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,6) = strpad('f_inf_LVA_SM in component f_LVA_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,30) = strpad('tau_f_LVA_SM in component f_LVA_SM (time_units)');
    LEGEND_STATES(:,8) = strpad('f_LVA_SM in component f_LVA_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,44) = strpad('E_Ca in component I_LVA_SM (voltage_units)');
    LEGEND_CONSTANTS(:,19) = strpad('G_max_LVA in component I_LVA_SM (conductance_units)');
    LEGEND_ALGEBRAIC(:,48) = strpad('d_BK_SM in component d_BK_SM (dimensionless)');
    LEGEND_CONSTANTS(:,183) = strpad('E_K in component I_BK_SM (voltage_units)');
    LEGEND_CONSTANTS(:,20) = strpad('G_max_BK in component I_BK_SM (conductance_units)');
    LEGEND_ALGEBRAIC(:,7) = strpad('T in component active_tension (kilopascals)');
    LEGEND_CONSTANTS(:,21) = strpad('Ca50_0 in component active_tension (micromolar)');
    LEGEND_CONSTANTS(:,184) = strpad('S_iCa50 in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,196) = strpad('Ca50 in component active_tension (micromolar)');
    LEGEND_CONSTANTS(:,22) = strpad('h in component active_tension (dimensionless)');
    LEGEND_CONSTANTS(:,23) = strpad('T_max in component active_tension (kilopascals)');
    LEGEND_CONSTANTS(:,24) = strpad('x_e in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,25) = strpad('x_i in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,166) = strpad('w_iICC in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,165) = strpad('w_iSMC in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,167) = strpad('w_e in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,26) = strpad('k_iAno1 in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,27) = strpad('k_iNSCC in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,28) = strpad('k_iCa50 in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,29) = strpad('k_iSK in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,30) = strpad('k_eIP3 in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,185) = strpad('S_iAno1 in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,186) = strpad('S_iNSCC in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,195) = strpad('S_eIP3 in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,31) = strpad('p_iICC in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,32) = strpad('p_iSMC in component neural_input (dimensionless)');
    LEGEND_CONSTANTS(:,33) = strpad('p_e in component neural_input (dimensionless)');
    LEGEND_STATES(:,9) = strpad('x_SK_SM in component x_SK_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,8) = strpad('x_SK_inf_SM in component x_SK_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,31) = strpad('tau_x_SK_SM in component x_SK_SM (time_units)');
    LEGEND_CONSTANTS(:,34) = strpad('n in component x_SK_SM (dimensionless)');
    LEGEND_CONSTANTS(:,35) = strpad('EC50 in component x_SK_SM (micromolar)');
    LEGEND_CONSTANTS(:,187) = strpad('E_K in component I_SK_SM (voltage_units)');
    LEGEND_CONSTANTS(:,36) = strpad('G_max_SK in component I_SK_SM (conductance_units)');
    LEGEND_CONSTANTS(:,188) = strpad('E_K in component I_bk_SM (voltage_units)');
    LEGEND_CONSTANTS(:,37) = strpad('G_max_bk in component I_bk_SM (conductance_units)');
    LEGEND_ALGEBRAIC(:,9) = strpad('xr1_inf_SM in component xr1_SM (dimensionless)');
    LEGEND_CONSTANTS(:,189) = strpad('tau_xr1_SM in component xr1_SM (time_units)');
    LEGEND_STATES(:,10) = strpad('xr1_SM in component xr1_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,10) = strpad('xr2_inf_SM in component xr2_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,32) = strpad('tau_xr2_SM in component xr2_SM (time_units)');
    LEGEND_STATES(:,11) = strpad('xr2_SM in component xr2_SM (dimensionless)');
    LEGEND_CONSTANTS(:,190) = strpad('E_K in component I_kr_SM (voltage_units)');
    LEGEND_CONSTANTS(:,38) = strpad('G_max_kr_SM in component I_kr_SM (conductance_units)');
    LEGEND_ALGEBRAIC(:,11) = strpad('m_inf_Na in component m_Na_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,33) = strpad('tau_m_Na in component m_Na_SM (time_units)');
    LEGEND_STATES(:,12) = strpad('m_Na_SM in component m_Na_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,12) = strpad('h_inf_Na in component h_Na_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,34) = strpad('tau_h_Na in component h_Na_SM (time_units)');
    LEGEND_STATES(:,13) = strpad('h_Na_SM in component h_Na_SM (dimensionless)');
    LEGEND_CONSTANTS(:,191) = strpad('E_Na in component I_Na_SM (voltage_units)');
    LEGEND_CONSTANTS(:,39) = strpad('G_max_Na_SM in component I_Na_SM (conductance_units)');
    LEGEND_ALGEBRAIC(:,13) = strpad('xa1_inf_SM in component xa1_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,35) = strpad('tau_xa1_SM in component xa1_SM (time_units)');
    LEGEND_STATES(:,14) = strpad('xa1_SM in component xa1_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,14) = strpad('xa2_inf_SM in component xa2_SM (dimensionless)');
    LEGEND_CONSTANTS(:,192) = strpad('tau_xa2_SM in component xa2_SM (time_units)');
    LEGEND_STATES(:,15) = strpad('xa2_SM in component xa2_SM (dimensionless)');
    LEGEND_CONSTANTS(:,193) = strpad('E_K in component I_ka_SM (voltage_units)');
    LEGEND_CONSTANTS(:,40) = strpad('G_max_ka_SM in component I_ka_SM (conductance_units)');
    LEGEND_ALGEBRAIC(:,15) = strpad('m_inf_NSCC_SM in component m_NSCC_SM (dimensionless)');
    LEGEND_ALGEBRAIC(:,36) = strpad('tau_m_NSCC_SM in component m_NSCC_SM (time_units)');
    LEGEND_STATES(:,16) = strpad('m_NSCC_SM in component m_NSCC_SM (dimensionless)');
    LEGEND_CONSTANTS(:,41) = strpad('E_NSCC in component I_NSCC_SM (voltage_units)');
    LEGEND_CONSTANTS(:,42) = strpad('G_max_NSCC_SM in component I_NSCC_SM (conductance_units)');
    LEGEND_CONSTANTS(:,43) = strpad('Ach in component I_NSCC_SM (millimolar)');
    LEGEND_ALGEBRAIC(:,63) = strpad('f_ca_NSCC_SM in component I_NSCC_SM (dimensionless)');
    LEGEND_CONSTANTS(:,168) = strpad('rach_NSCC_SM in component I_NSCC_SM (dimensionless)');
    LEGEND_CONSTANTS(:,44) = strpad('p2m in component Parameters (dimensionless)');
    LEGEND_CONSTANTS(:,45) = strpad('umc2L in component Parameters (dimensionless)');
    LEGEND_CONSTANTS(:,46) = strpad('T in component Parameters (Temperature_units)');
    LEGEND_CONSTANTS(:,47) = strpad('F in component Parameters (F_units_ICC)');
    LEGEND_CONSTANTS(:,48) = strpad('R in component Parameters (R_units_ICC)');
    LEGEND_CONSTANTS(:,49) = strpad('z_ca in component Parameters (dimensionless)');
    LEGEND_CONSTANTS(:,50) = strpad('z_na in component Parameters (dimensionless)');
    LEGEND_CONSTANTS(:,51) = strpad('z_k in component Parameters (dimensionless)');
    LEGEND_CONSTANTS(:,52) = strpad('z_cl in component Parameters (dimensionless)');
    LEGEND_CONSTANTS(:,53) = strpad('Ca_o in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,54) = strpad('Cl_i in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,55) = strpad('Cl_o in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,56) = strpad('K_i in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,57) = strpad('K_o in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,58) = strpad('Na_i in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,59) = strpad('Na_o in component Parameters (micromolar)');
    LEGEND_CONSTANTS(:,60) = strpad('cellVol in component Volume (litre)');
    LEGEND_CONSTANTS(:,61) = strpad('cellPropER in component Volume (dimensionless)');
    LEGEND_CONSTANTS(:,62) = strpad('cellPropCyto in component Volume (dimensionless)');
    LEGEND_CONSTANTS(:,172) = strpad('volER in component Volume (litre)');
    LEGEND_CONSTANTS(:,194) = strpad('volCyto in component Volume (litre)');
    LEGEND_STATES(:,17) = strpad('Ca_i in component ICC_Membrane (micromolar)');
    LEGEND_CONSTANTS(:,63) = strpad('E_NSCC in component Nernst (voltage_units)');
    LEGEND_CONSTANTS(:,64) = strpad('E_NSV in component Nernst (voltage_units)');
    LEGEND_CONSTANTS(:,65) = strpad('E_SOC in component Nernst (voltage_units)');
    LEGEND_ALGEBRAIC(:,16) = strpad('E_Ca in component Nernst (voltage_units)');
    LEGEND_CONSTANTS(:,169) = strpad('E_Cl in component Nernst (voltage_units)');
    LEGEND_CONSTANTS(:,170) = strpad('E_Na in component Nernst (voltage_units)');
    LEGEND_CONSTANTS(:,171) = strpad('E_K in component Nernst (voltage_units)');
    LEGEND_CONSTANTS(:,66) = strpad('d_CaT_Vh in component d_CaT (voltage_units)');
    LEGEND_CONSTANTS(:,67) = strpad('d_CaT_S in component d_CaT (voltage_units)');
    LEGEND_CONSTANTS(:,68) = strpad('d_CaT_tau in component d_CaT (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,17) = strpad('d_CaT_inf in component d_CaT (dimensionless)');
    LEGEND_STATES(:,18) = strpad('d_CaT in component d_CaT (dimensionless)');
    LEGEND_CONSTANTS(:,69) = strpad('f_CaT_Vh in component f_CaT (voltage_units)');
    LEGEND_CONSTANTS(:,70) = strpad('f_CaT_S in component f_CaT (voltage_units)');
    LEGEND_CONSTANTS(:,71) = strpad('f_CaT_tau in component f_CaT (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,18) = strpad('f_CaT_inf in component f_CaT (dimensionless)');
    LEGEND_STATES(:,19) = strpad('f_CaT in component f_CaT (dimensionless)');
    LEGEND_CONSTANTS(:,72) = strpad('g_CaT in component I_CaT (conductance_units)');
    LEGEND_ALGEBRAIC(:,37) = strpad('I_CaT in component I_CaT (current_units)');
    LEGEND_ALGEBRAIC(:,41) = strpad('J_CaT in component I_CaT (micromolar_per_second)');
    LEGEND_CONSTANTS(:,73) = strpad('d_CaV_Vh in component d_CaV (voltage_units)');
    LEGEND_CONSTANTS(:,74) = strpad('d_CaV_S in component d_CaV (voltage_units)');
    LEGEND_CONSTANTS(:,75) = strpad('d_CaV_tau in component d_CaV (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,19) = strpad('d_CaV_inf in component d_CaV (dimensionless)');
    LEGEND_STATES(:,20) = strpad('d_CaV in component d_CaV (dimensionless)');
    LEGEND_CONSTANTS(:,76) = strpad('g_CaV in component I_CaV (conductance_units)');
    LEGEND_ALGEBRAIC(:,43) = strpad('I_CaV in component I_CaV (current_units)');
    LEGEND_ALGEBRAIC(:,45) = strpad('J_CaV in component I_CaV (micromolar_per_second)');
    LEGEND_CONSTANTS(:,77) = strpad('d_NaV_Vh in component d_NaV (voltage_units)');
    LEGEND_CONSTANTS(:,78) = strpad('d_NaV_S in component d_NaV (voltage_units)');
    LEGEND_CONSTANTS(:,79) = strpad('d_NaV_t1 in component d_NaV (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,80) = strpad('d_NaV_t2 in component d_NaV (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,81) = strpad('d_NaV_t3 in component d_NaV (Inverse_Voltage_ICC)');
    LEGEND_CONSTANTS(:,82) = strpad('d_NaV_t4 in component d_NaV (voltage_units)');
    LEGEND_ALGEBRAIC(:,38) = strpad('d_NaV_tau in component d_NaV (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,20) = strpad('d_NaV_inf in component d_NaV (dimensionless)');
    LEGEND_STATES(:,21) = strpad('d_NaV in component d_NaV (dimensionless)');
    LEGEND_CONSTANTS(:,83) = strpad('f_NaV_Vh in component f_NaV (voltage_units)');
    LEGEND_CONSTANTS(:,84) = strpad('f_NaV_S in component f_NaV (voltage_units)');
    LEGEND_CONSTANTS(:,85) = strpad('f_NaV_tau in component f_NaV (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,21) = strpad('f_NaV_inf in component f_NaV (dimensionless)');
    LEGEND_STATES(:,22) = strpad('f_NaV in component f_NaV (dimensionless)');
    LEGEND_CONSTANTS(:,86) = strpad('g_NaV in component I_NaV (conductance_units)');
    LEGEND_ALGEBRAIC(:,49) = strpad('I_NaV in component I_NaV (current_units)');
    LEGEND_ALGEBRAIC(:,47) = strpad('f_NaV_new in component I_NaV (dimensionless)');
    LEGEND_CONSTANTS(:,87) = strpad('a_LCl_NaV in component I_NaV (dimensionless)');
    LEGEND_CONSTANTS(:,88) = strpad('a_HCl_NaV in component I_NaV (dimensionless)');
    LEGEND_CONSTANTS(:,89) = strpad('SOC_h in component P_SOC (micromolar)');
    LEGEND_STATES(:,23) = strpad('Ca_er in component Ca_er (micromolar)');
    LEGEND_CONSTANTS(:,90) = strpad('SOC_n in component P_SOC (dimensionless)');
    LEGEND_ALGEBRAIC(:,51) = strpad('P_SOC in component P_SOC (dimensionless)');
    LEGEND_CONSTANTS(:,91) = strpad('g_SOC in component I_SOC (conductance_units)');
    LEGEND_CONSTANTS(:,92) = strpad('SOCPropCa in component I_SOC (dimensionless)');
    LEGEND_ALGEBRAIC(:,53) = strpad('I_SOC in component I_SOC (current_units)');
    LEGEND_ALGEBRAIC(:,55) = strpad('J_SOC in component I_SOC (micromolar_per_second)');
    LEGEND_CONSTANTS(:,93) = strpad('d_KV_Vh in component d_KV (voltage_units)');
    LEGEND_CONSTANTS(:,94) = strpad('d_KV_S in component d_KV (voltage_units)');
    LEGEND_CONSTANTS(:,95) = strpad('d_KV_tau in component d_KV (time_units_ICC)');
    LEGEND_STATES(:,24) = strpad('d_KV in component d_KV (dimensionless)');
    LEGEND_ALGEBRAIC(:,22) = strpad('d_KV_inf in component d_KV (dimensionless)');
    LEGEND_CONSTANTS(:,96) = strpad('f_KV_Vh in component f_KV (voltage_units)');
    LEGEND_CONSTANTS(:,97) = strpad('f_KV_S in component f_KV (voltage_units)');
    LEGEND_CONSTANTS(:,98) = strpad('f_KV_a in component f_KV (dimensionless)');
    LEGEND_CONSTANTS(:,99) = strpad('f_KV_tau in component f_KV (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,23) = strpad('f_KV_inf in component f_KV (dimensionless)');
    LEGEND_STATES(:,25) = strpad('f_KV in component f_KV (dimensionless)');
    LEGEND_CONSTANTS(:,100) = strpad('g_KV in component I_KV (conductance_units)');
    LEGEND_ALGEBRAIC(:,57) = strpad('I_KV in component I_KV (current_units)');
    LEGEND_CONSTANTS(:,101) = strpad('d_NSV_Vh in component d_NSV (voltage_units)');
    LEGEND_CONSTANTS(:,102) = strpad('d_NSV_S in component d_NSV (voltage_units)');
    LEGEND_CONSTANTS(:,103) = strpad('d_NSV_tau in component d_NSV (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,24) = strpad('d_NSV_inf in component d_NSV (dimensionless)');
    LEGEND_STATES(:,26) = strpad('d_NSV in component d_NSV (dimensionless)');
    LEGEND_CONSTANTS(:,104) = strpad('f_NSV_Vh in component f_NSV (voltage_units)');
    LEGEND_CONSTANTS(:,105) = strpad('f_NSV_S in component f_NSV (voltage_units)');
    LEGEND_CONSTANTS(:,106) = strpad('f_NSV_tau in component f_NSV (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,25) = strpad('f_NSV_inf in component f_NSV (dimensionless)');
    LEGEND_STATES(:,27) = strpad('f_NSV in component f_NSV (dimensionless)');
    LEGEND_CONSTANTS(:,107) = strpad('g_NSV in component I_NSV (conductance_units)');
    LEGEND_ALGEBRAIC(:,59) = strpad('I_NSV in component I_NSV (current_units)');
    LEGEND_ALGEBRAIC(:,61) = strpad('J_NSV in component I_NSV (micromolar_per_second)');
    LEGEND_CONSTANTS(:,108) = strpad('g_BK in component I_BK (conductance_units)');
    LEGEND_ALGEBRAIC(:,62) = strpad('I_BK in component I_BK (current_units)');
    LEGEND_CONSTANTS(:,109) = strpad('d_KERG_Vh in component d_KERG (voltage_units)');
    LEGEND_CONSTANTS(:,110) = strpad('d_KERG_S in component d_KERG (voltage_units)');
    LEGEND_CONSTANTS(:,111) = strpad('d_KERG_ta in component d_KERG (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,112) = strpad('d_KERG_tV in component d_KERG (voltage_units)');
    LEGEND_CONSTANTS(:,113) = strpad('d_KERG_tS in component d_KERG (voltage_units)');
    LEGEND_ALGEBRAIC(:,26) = strpad('d_KERG_tau in component d_KERG (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,39) = strpad('d_KERG_inf in component d_KERG (dimensionless)');
    LEGEND_STATES(:,28) = strpad('d_KERG in component d_KERG (dimensionless)');
    LEGEND_CONSTANTS(:,114) = strpad('f_KERG_Vh in component f_KERG (voltage_units)');
    LEGEND_CONSTANTS(:,115) = strpad('f_KERG_S in component f_KERG (voltage_units)');
    LEGEND_CONSTANTS(:,116) = strpad('f_KERG_a in component f_KERG (dimensionless)');
    LEGEND_CONSTANTS(:,117) = strpad('f_KERG_tau in component f_KERG (time_units_ICC)');
    LEGEND_ALGEBRAIC(:,27) = strpad('f_KERG_inf in component f_KERG (dimensionless)');
    LEGEND_STATES(:,29) = strpad('f_KERG in component f_KERG (dimensionless)');
    LEGEND_CONSTANTS(:,118) = strpad('g_KERG in component I_KERG (conductance_units)');
    LEGEND_ALGEBRAIC(:,64) = strpad('I_KERG in component I_KERG (current_units)');
    LEGEND_ALGEBRAIC(:,66) = strpad('I_stim in component I_stim (current_units)');
    LEGEND_ALGEBRAIC(:,67) = strpad('P_NSCC in component P_NSCC (dimensionless)');
    LEGEND_CONSTANTS(:,119) = strpad('n_NSCC in component P_NSCC (dimensionless)');
    LEGEND_CONSTANTS(:,120) = strpad('Ca_NSCC in component P_NSCC (micromolar)');
    LEGEND_CONSTANTS(:,121) = strpad('g_NSCC in component I_NSCC (rate_constants_units_second)');
    LEGEND_ALGEBRAIC(:,68) = strpad('I_NSCC in component I_NSCC (current_units)');
    LEGEND_CONSTANTS(:,122) = strpad('Dc in component d_Ano1 (micrometer2_per_time)');
    LEGEND_CONSTANTS(:,123) = strpad('Dm in component d_Ano1 (micrometer2_per_time)');
    LEGEND_CONSTANTS(:,124) = strpad('Bm in component d_Ano1 (micromolar)');
    LEGEND_CONSTANTS(:,125) = strpad('Km in component d_Ano1 (micromolar)');
    LEGEND_CONSTANTS(:,126) = strpad('kc in component d_Ano1 (Inverse_Voltage_ICC)');
    LEGEND_CONSTANTS(:,127) = strpad('nSOC in component d_Ano1 (dimensionless)');
    LEGEND_CONSTANTS(:,173) = strpad('rad in component d_Ano1 (micrometer)');
    LEGEND_ALGEBRAIC(:,69) = strpad('mouthCa in component d_Ano1 (micromolar_per_second)');
    LEGEND_ALGEBRAIC(:,70) = strpad('localCa in component d_Ano1 (micromolar)');
    LEGEND_ALGEBRAIC(:,71) = strpad('d_Ano1_tau in component d_Ano1 (time_units_ICC)');
    LEGEND_CONSTANTS(:,128) = strpad('d_Ano1_tscale in component d_Ano1 (dimensionless)');
    LEGEND_CONSTANTS(:,129) = strpad('colocalRadius in component d_Ano1 (micrometer)');
    LEGEND_ALGEBRAIC(:,72) = strpad('d_Ano1_inf in component d_Ano1 (dimensionless)');
    LEGEND_STATES(:,30) = strpad('d_Ano1 in component d_Ano1 (dimensionless)');
    LEGEND_CONSTANTS(:,130) = strpad('Ano1_n in component d_Ano1 (dimensionless)');
    LEGEND_CONSTANTS(:,131) = strpad('Ano1_Vh in component d_Ano1 (voltage_units)');
    LEGEND_CONSTANTS(:,132) = strpad('Ano1_s in component d_Ano1 (voltage_units)');
    LEGEND_ALGEBRAIC(:,73) = strpad('h_Ano1 in component d_Ano1 (dimensionless)');
    LEGEND_CONSTANTS(:,133) = strpad('g_Ano1 in component I_Ano1 (conductance_units)');
    LEGEND_ALGEBRAIC(:,74) = strpad('I_Ano1 in component I_Ano1 (current_units)');
    LEGEND_CONSTANTS(:,134) = strpad('Ke in component J_SERCA (micromolar)');
    LEGEND_ALGEBRAIC(:,75) = strpad('J_SERCA in component J_SERCA (micromolar_per_second)');
    LEGEND_CONSTANTS(:,135) = strpad('Ve in component J_SERCA (micromolar_per_second)');
    LEGEND_CONSTANTS(:,136) = strpad('fc in component J_SERCA (dimensionless)');
    LEGEND_CONSTANTS(:,137) = strpad('fe in component J_SERCA (dimensionless)');
    LEGEND_ALGEBRAIC(:,77) = strpad('J_IPR in component J_IPR (micromolar_per_second)');
    LEGEND_CONSTANTS(:,138) = strpad('k1 in component y_bind (per_micromolarsecond)');
    LEGEND_CONSTANTS(:,139) = strpad('k2 in component y_bind (per_micromolarsecond)');
    LEGEND_CONSTANTS(:,140) = strpad('k3 in component y_bind (per_micromolarsecond)');
    LEGEND_CONSTANTS(:,141) = strpad('k4 in component y_bind (per_micromolarsecond)');
    LEGEND_CONSTANTS(:,142) = strpad('k5 in component y_bind (per_micromolarsecond)');
    LEGEND_CONSTANTS(:,143) = strpad('k_1 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,144) = strpad('k_2 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,145) = strpad('k_3 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,146) = strpad('k_4 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,147) = strpad('k_5 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,198) = strpad('IP3 in component J_IPR (micromolar)');
    LEGEND_CONSTANTS(:,174) = strpad('K1 in component y_bind (micromolar)');
    LEGEND_CONSTANTS(:,175) = strpad('K2 in component y_bind (micromolar)');
    LEGEND_CONSTANTS(:,197) = strpad('K3 in component y_bind (micromolar)');
    LEGEND_CONSTANTS(:,176) = strpad('K4 in component y_bind (micromolar)');
    LEGEND_CONSTANTS(:,177) = strpad('K5 in component y_bind (micromolar)');
    LEGEND_STATES(:,31) = strpad('y in component y_bind (dimensionless)');
    LEGEND_ALGEBRAIC(:,28) = strpad('phi1 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,199) = strpad('phi2 in component y_bind (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,148) = strpad('kipr in component J_IPR (rate_constants_units_second)');
    LEGEND_ALGEBRAIC(:,76) = strpad('Pipr in component J_IPR (dimensionless)');
    LEGEND_CONSTANTS(:,149) = strpad('Jer in component J_IPR (rate_constants_units_second)');
    LEGEND_CONSTANTS(:,150) = strpad('IP3_base in component J_IPR (micromolar)');
    LEGEND_CONSTANTS(:,151) = strpad('switch_NCX in component I_NCX (dimensionless)');
    LEGEND_CONSTANTS(:,152) = strpad('v_NCX in component I_NCX (micromolar_per_second)');
    LEGEND_ALGEBRAIC(:,78) = strpad('J_NCX in component I_NCX (micromolar_per_second)');
    LEGEND_ALGEBRAIC(:,80) = strpad('I_NCX in component I_NCX (current_units)');
    LEGEND_CONSTANTS(:,153) = strpad('g_PMCA in component J_PMCA (dimensionless)');
    LEGEND_CONSTANTS(:,154) = strpad('J_PMCA_max in component J_PMCA (micromolar_per_second)');
    LEGEND_CONSTANTS(:,155) = strpad('K_PMCA in component J_PMCA (micromolar)');
    LEGEND_CONSTANTS(:,156) = strpad('n_PMCA in component J_PMCA (dimensionless)');
    LEGEND_ALGEBRAIC(:,79) = strpad('J_PMCA in component J_PMCA (micromolar_per_second)');
    LEGEND_CONSTANTS(:,157) = strpad('g_BNa in component I_BNa (conductance_units)');
    LEGEND_ALGEBRAIC(:,81) = strpad('I_BNa in component I_BNa (current_units)');
    LEGEND_CONSTANTS(:,158) = strpad('Cm in component ICC_Membrane (capacitance_units_ICC)');
    LEGEND_ALGEBRAIC(:,82) = strpad('Iion in component ICC_Membrane (current_units)');
    LEGEND_RATES(:,1) = strpad('d/dt Vm_SM in component SM_Membrane (voltage_units)');
    LEGEND_RATES(:,2) = strpad('d/dt Ca_i in component SM_Membrane (millimolar)');
    LEGEND_RATES(:,4) = strpad('d/dt d_Ltype_SM in component d_Ltype_SM (dimensionless)');
    LEGEND_RATES(:,5) = strpad('d/dt f_Ltype_SM in component f_Ltype_SM (dimensionless)');
    LEGEND_RATES(:,6) = strpad('d/dt f_ca_Ltype_SM in component f_ca_Ltype_SM (dimensionless)');
    LEGEND_RATES(:,7) = strpad('d/dt d_LVA_SM in component d_LVA_SM (dimensionless)');
    LEGEND_RATES(:,8) = strpad('d/dt f_LVA_SM in component f_LVA_SM (dimensionless)');
    LEGEND_RATES(:,9) = strpad('d/dt x_SK_SM in component x_SK_SM (dimensionless)');
    LEGEND_RATES(:,10) = strpad('d/dt xr1_SM in component xr1_SM (dimensionless)');
    LEGEND_RATES(:,11) = strpad('d/dt xr2_SM in component xr2_SM (dimensionless)');
    LEGEND_RATES(:,12) = strpad('d/dt m_Na_SM in component m_Na_SM (dimensionless)');
    LEGEND_RATES(:,13) = strpad('d/dt h_Na_SM in component h_Na_SM (dimensionless)');
    LEGEND_RATES(:,14) = strpad('d/dt xa1_SM in component xa1_SM (dimensionless)');
    LEGEND_RATES(:,15) = strpad('d/dt xa2_SM in component xa2_SM (dimensionless)');
    LEGEND_RATES(:,16) = strpad('d/dt m_NSCC_SM in component m_NSCC_SM (dimensionless)');
    LEGEND_RATES(:,18) = strpad('d/dt d_CaT in component d_CaT (dimensionless)');
    LEGEND_RATES(:,19) = strpad('d/dt f_CaT in component f_CaT (dimensionless)');
    LEGEND_RATES(:,20) = strpad('d/dt d_CaV in component d_CaV (dimensionless)');
    LEGEND_RATES(:,21) = strpad('d/dt d_NaV in component d_NaV (dimensionless)');
    LEGEND_RATES(:,22) = strpad('d/dt f_NaV in component f_NaV (dimensionless)');
    LEGEND_RATES(:,24) = strpad('d/dt d_KV in component d_KV (dimensionless)');
    LEGEND_RATES(:,25) = strpad('d/dt f_KV in component f_KV (dimensionless)');
    LEGEND_RATES(:,26) = strpad('d/dt d_NSV in component d_NSV (dimensionless)');
    LEGEND_RATES(:,27) = strpad('d/dt f_NSV in component f_NSV (dimensionless)');
    LEGEND_RATES(:,28) = strpad('d/dt d_KERG in component d_KERG (dimensionless)');
    LEGEND_RATES(:,29) = strpad('d/dt f_KERG in component f_KERG (dimensionless)');
    LEGEND_RATES(:,30) = strpad('d/dt d_Ano1 in component d_Ano1 (dimensionless)');
    LEGEND_RATES(:,23) = strpad('d/dt Ca_er in component Ca_er (micromolar)');
    LEGEND_RATES(:,31) = strpad('d/dt y in component y_bind (dimensionless)');
    LEGEND_RATES(:,3) = strpad('d/dt Vm in component ICC_Membrane (voltage_units)');
    LEGEND_RATES(:,17) = strpad('d/dt Ca_i in component ICC_Membrane (micromolar)');
    LEGEND_STATES  = LEGEND_STATES';
    LEGEND_ALGEBRAIC = LEGEND_ALGEBRAIC';
    LEGEND_RATES = LEGEND_RATES';
    LEGEND_CONSTANTS = LEGEND_CONSTANTS';
end

function [STATES, CONSTANTS] = initConsts(e, w, x_e, x_i)
    VOI = 0; CONSTANTS = []; STATES = []; ALGEBRAIC = [];
    CONSTANTS(:,1) = 310;
    CONSTANTS(:,2) = 297;
    CONSTANTS(:,3) = 96486;
    CONSTANTS(:,4) = 8314.4;
    CONSTANTS(:,5) = 2.1;
    CONSTANTS(:,6) = 1.365;
    CONSTANTS(:,7) = 2.45;
    CONSTANTS(:,8) = 2.5;
    CONSTANTS(:,9) = 137;
    CONSTANTS(:,10) = 5.9;
    CONSTANTS(:,11) = 134;
    CONSTANTS(:,12) = 77;
    CONSTANTS(:,13) = 3500;
    STATES(:,1) = -69.75;
    STATES(:,2) = 0.00008;
    CONSTANTS(:,14) = 10;
    CONSTANTS(:,15) = 164;
    CONSTANTS(:,16) = 1.3;
    STATES(:,3) = -66.0;
    STATES(:,4) = 0.0;
    STATES(:,5) = 0.95;
    STATES(:,6) = 1.0;
    CONSTANTS(:,17) = 65;
    CONSTANTS(:,18) = 0.31705;
    STATES(:,7) = 0.02;
    STATES(:,8) = 0.99;
    CONSTANTS(:,19) = 0.18;
    CONSTANTS(:,20) = 45.7;
    CONSTANTS(:,21) = 0.5623413;
    CONSTANTS(:,22) = 3.4;
    CONSTANTS(:,23) = 313;
    CONSTANTS(:,24) = x_e;
    CONSTANTS(:,25) = x_i;
    CONSTANTS(:,26) = e(1);
    CONSTANTS(:,27) = e(2);
    CONSTANTS(:,28) = e(3);
    CONSTANTS(:,29) = e(4);
    CONSTANTS(:,30) = e(5);
    CONSTANTS(:,31) = w(1);
    CONSTANTS(:,32) = w(2);
    CONSTANTS(:,33) = w(3);
    STATES(:,9) = 0;
    CONSTANTS(:,34) = 2;
    CONSTANTS(:,35) = 0.3;
    CONSTANTS(:,36) = 3.5;
    CONSTANTS(:,37) = 0.0144;
    STATES(:,10) = 0.0;
    STATES(:,11) = 0.82;
    CONSTANTS(:,38) = 35;
    STATES(:,12) = 0.005;
    STATES(:,13) = 0.05787;
    CONSTANTS(:,39) = 3;
    STATES(:,14) = 0.00414;
    STATES(:,15) = 0.72;
    CONSTANTS(:,40) = 9;
    STATES(:,16) = 0.0;
    CONSTANTS(:,41) = -28;
    CONSTANTS(:,42) = 50;
    CONSTANTS(:,43) = 0.00001;
    CONSTANTS(:,44) = 1e-09;
    CONSTANTS(:,45) = 1e+15;
    CONSTANTS(:,46) = 310;
    CONSTANTS(:,47) = 96.4846;
    CONSTANTS(:,48) = 8.3144;
    CONSTANTS(:,49) = 2;
    CONSTANTS(:,50) = 1;
    CONSTANTS(:,51) = 1;
    CONSTANTS(:,52) = -1;
    CONSTANTS(:,53) = 2000;
    CONSTANTS(:,54) = 78000;
    CONSTANTS(:,55) = 166000;
    CONSTANTS(:,56) = 140000;
    CONSTANTS(:,57) = 5000;
    CONSTANTS(:,58) = 30000;
    CONSTANTS(:,59) = 140000;
    CONSTANTS(:,60) = 1e-12;
    CONSTANTS(:,61) = 0.1;
    CONSTANTS(:,62) = 0.7;
    STATES(:,17) = 0.14;
    CONSTANTS(:,63) = 0;
    CONSTANTS(:,64) = 0;
    CONSTANTS(:,65) = 0;
    CONSTANTS(:,66) = -40;
    CONSTANTS(:,67) = -3;
    CONSTANTS(:,68) = 0.006;
    STATES(:,18) = 0.001271016263081;
    CONSTANTS(:,69) = -55;
    CONSTANTS(:,70) = 5;
    CONSTANTS(:,71) = 0.1;
    STATES(:,19) = 0.5;
    CONSTANTS(:,72) = 4;
    CONSTANTS(:,73) = -26;
    CONSTANTS(:,74) = -6;
    CONSTANTS(:,75) = 0.006;
    STATES(:,20) = 0.001271016263081;
    CONSTANTS(:,76) = 0.0;
    CONSTANTS(:,77) = -25;
    CONSTANTS(:,78) = -5.6;
    CONSTANTS(:,79) = 50;
    CONSTANTS(:,80) = 1050;
    CONSTANTS(:,81) = -0.06;
    CONSTANTS(:,82) = -20;
    STATES(:,21) = 0.0006607800216060858;
    CONSTANTS(:,83) = -39;
    CONSTANTS(:,84) = -5.6;
    CONSTANTS(:,85) = 1;
    STATES(:,22) = 1.0;
    CONSTANTS(:,86) = 0;
    CONSTANTS(:,87) = 0;
    CONSTANTS(:,88) = 1;
    CONSTANTS(:,89) = 200;
    STATES(:,23) = 290.0;
    CONSTANTS(:,90) = 8;
    CONSTANTS(:,91) = 0.1;
    CONSTANTS(:,92) = 1;
    CONSTANTS(:,93) = -20;
    CONSTANTS(:,94) = -4.6;
    CONSTANTS(:,95) = 0.045;
    STATES(:,24) = 0.01;
    CONSTANTS(:,96) = -45;
    CONSTANTS(:,97) = 4.4;
    CONSTANTS(:,98) = 1;
    CONSTANTS(:,99) = 0.045;
    STATES(:,25) = 0.583726132461315;
    CONSTANTS(:,100) = 0;
    CONSTANTS(:,101) = -30;
    CONSTANTS(:,102) = -5;
    CONSTANTS(:,103) = 0.005;
    STATES(:,26) = 0.001271016263081;
    CONSTANTS(:,104) = -50;
    CONSTANTS(:,105) = 5;
    CONSTANTS(:,106) = 0.8;
    STATES(:,27) = 0.5;
    CONSTANTS(:,107) = 0;
    CONSTANTS(:,108) = 9;
    CONSTANTS(:,109) = -35;
    CONSTANTS(:,110) = -7.1;
    CONSTANTS(:,111) = 0.15;
    CONSTANTS(:,112) = -60;
    CONSTANTS(:,113) = 20;
    STATES(:,28) = 0.001;
    CONSTANTS(:,114) = -42;
    CONSTANTS(:,115) = 4;
    CONSTANTS(:,116) = 1;
    CONSTANTS(:,117) = 0.003;
    STATES(:,29) = 0.001;
    CONSTANTS(:,118) = 0;
    CONSTANTS(:,119) = 4;
    CONSTANTS(:,120) = 1.8;
    CONSTANTS(:,121) = 30;
    CONSTANTS(:,122) = 250;
    CONSTANTS(:,123) = 75;
    CONSTANTS(:,124) = 50;
    CONSTANTS(:,125) = 1;
    CONSTANTS(:,126) = 0.01248;
    CONSTANTS(:,127) = 50;
    CONSTANTS(:,128) = 1;
    CONSTANTS(:,129) = 0.05;
    STATES(:,30) = 0.01;
    CONSTANTS(:,130) = 2;
    CONSTANTS(:,131) = -100;
    CONSTANTS(:,132) = 0.0156;
    CONSTANTS(:,133) = 20;
    CONSTANTS(:,134) = 0.1;
    CONSTANTS(:,135) = 160;
    CONSTANTS(:,136) = 0.01;
    CONSTANTS(:,137) = 1;
    CONSTANTS(:,138) = 500;
    CONSTANTS(:,139) = 0.25;
    CONSTANTS(:,140) = 500;
    CONSTANTS(:,141) = 0.25;
    CONSTANTS(:,142) = 25;
    CONSTANTS(:,143) = 65;
    CONSTANTS(:,144) = 0.2625;
    CONSTANTS(:,145) = 471.5;
    CONSTANTS(:,146) = 0.03625;
    CONSTANTS(:,147) = 2.05;
    STATES(:,31) = 0.4;
    CONSTANTS(:,148) = 7;
    CONSTANTS(:,149) = 0.01;
    CONSTANTS(:,150) = 0.5;
    CONSTANTS(:,151) = 0;
    CONSTANTS(:,152) = 225;
    CONSTANTS(:,153) = 1;
    CONSTANTS(:,154) = 100;
    CONSTANTS(:,155) = 0.1;
    CONSTANTS(:,156) = 2;
    CONSTANTS(:,157) = 2;
    CONSTANTS(:,158) = 0.025;
    CONSTANTS(:,159) = power(CONSTANTS(:,7), (CONSTANTS(:,1) - CONSTANTS(:,2))./10.0000);
    CONSTANTS(:,160) = power(CONSTANTS(:,6), (CONSTANTS(:,1) - CONSTANTS(:,2))./10.0000);
    CONSTANTS(:,161) = power(CONSTANTS(:,5), (CONSTANTS(:,1) - CONSTANTS(:,2))./10.0000);
    CONSTANTS(:,162) =  1.10000.*(CONSTANTS(:,1) - CONSTANTS(:,2));
    CONSTANTS(:,163) = CONSTANTS(:,3)./( CONSTANTS(:,4).*CONSTANTS(:,1));
    CONSTANTS(:,164) = ( CONSTANTS(:,4).*CONSTANTS(:,1))./CONSTANTS(:,3);
    CONSTANTS(:,165) = (1.00000 - exp(  - CONSTANTS(:,32).*CONSTANTS(:,25)))./(1.00000 - exp( - CONSTANTS(:,32)));
    CONSTANTS(:,166) = (1.00000 - exp(  - CONSTANTS(:,31).*CONSTANTS(:,25)))./(1.00000 - exp( - CONSTANTS(:,31)));
    CONSTANTS(:,167) = (1.00000 - exp(  - CONSTANTS(:,33).*CONSTANTS(:,24)))./(1.00000 - exp( - CONSTANTS(:,33)));
    CONSTANTS(:,168) = 1.00000./(1.00000+0.0100000./CONSTANTS(:,43));
    CONSTANTS(:,169) =  (( CONSTANTS(:,48).*CONSTANTS(:,46))./( CONSTANTS(:,47).*CONSTANTS(:,52))).*log(CONSTANTS(:,55)./CONSTANTS(:,54));
    CONSTANTS(:,170) =  (( CONSTANTS(:,48).*CONSTANTS(:,46))./( CONSTANTS(:,47).*CONSTANTS(:,50))).*log(CONSTANTS(:,59)./CONSTANTS(:,58));
    CONSTANTS(:,171) =  (( CONSTANTS(:,48).*CONSTANTS(:,46))./( CONSTANTS(:,47).*CONSTANTS(:,51))).*log(CONSTANTS(:,57)./CONSTANTS(:,56));
    CONSTANTS(:,172) =  CONSTANTS(:,60).*CONSTANTS(:,61);
    CONSTANTS(:,173) = CONSTANTS(:,129);
    CONSTANTS(:,174) = CONSTANTS(:,143)./CONSTANTS(:,138);
    CONSTANTS(:,175) = CONSTANTS(:,144)./CONSTANTS(:,139);
    CONSTANTS(:,176) = CONSTANTS(:,146)./CONSTANTS(:,141);
    CONSTANTS(:,177) = CONSTANTS(:,147)./CONSTANTS(:,142);
    CONSTANTS(:,178) =  CONSTANTS(:,165).*CONSTANTS(:,29);
    CONSTANTS(:,179) =  CONSTANTS(:,161).*0.470000;
    CONSTANTS(:,180) =  CONSTANTS(:,161).*86.0000;
    CONSTANTS(:,181) =  CONSTANTS(:,161).*2.00000;
    CONSTANTS(:,182) =  CONSTANTS(:,161).*3.00000;
    CONSTANTS(:,183) =  CONSTANTS(:,164).*log(CONSTANTS(:,10)./CONSTANTS(:,15));
    CONSTANTS(:,184) =  CONSTANTS(:,165).*CONSTANTS(:,28);
    CONSTANTS(:,185) =  CONSTANTS(:,166).*CONSTANTS(:,26);
    CONSTANTS(:,186) =  CONSTANTS(:,166).*CONSTANTS(:,27);
    CONSTANTS(:,187) =  CONSTANTS(:,164).*log(CONSTANTS(:,10)./CONSTANTS(:,15));
    CONSTANTS(:,188) =  CONSTANTS(:,164).*log(CONSTANTS(:,10)./CONSTANTS(:,15));
    CONSTANTS(:,189) =  CONSTANTS(:,160).*80.0000;
    CONSTANTS(:,190) =  CONSTANTS(:,164).*log(CONSTANTS(:,10)./CONSTANTS(:,15));
    CONSTANTS(:,191) =  CONSTANTS(:,164).*log(CONSTANTS(:,9)./CONSTANTS(:,14));
    CONSTANTS(:,192) =  CONSTANTS(:,160).*90.0000;
    CONSTANTS(:,193) =  CONSTANTS(:,164).*log(CONSTANTS(:,10)./CONSTANTS(:,15));
    CONSTANTS(:,194) =  CONSTANTS(:,60).*CONSTANTS(:,62);
    CONSTANTS(:,195) =  CONSTANTS(:,167).*CONSTANTS(:,30);
    CONSTANTS(:,196) =  CONSTANTS(:,21).*(1.00000+CONSTANTS(:,184));
    CONSTANTS(:,197) = CONSTANTS(:,145)./CONSTANTS(:,140);
    CONSTANTS(:,198) =  CONSTANTS(:,150).*(1.00000+CONSTANTS(:,195));
    CONSTANTS(:,199) = ( CONSTANTS(:,144).*CONSTANTS(:,198)+ CONSTANTS(:,146).*CONSTANTS(:,197))./(CONSTANTS(:,197)+CONSTANTS(:,198));
    if (isempty(STATES)), warning('Initial values for states not set');, end
end

function [RATES, ALGEBRAIC] = computeRates(VOI, STATES, CONSTANTS)
    global algebraicVariableCount;
    statesSize = size(STATES);
    statesColumnCount = statesSize(2);
    if ( statesColumnCount == 1)
        STATES = STATES';
        ALGEBRAIC = zeros(1, algebraicVariableCount);
        utilOnes = 1;
    else
        statesRowCount = statesSize(1);
        ALGEBRAIC = zeros(statesRowCount, algebraicVariableCount);
        RATES = zeros(statesRowCount, statesColumnCount);
        utilOnes = ones(statesRowCount, 1);
    end
    ALGEBRAIC(:,2) = 1.00000./(1.00000+exp((STATES(:,1)+17.0000)./ - 4.30000));
    RATES(:,4) = (ALGEBRAIC(:,2) - STATES(:,4))./CONSTANTS(:,179);
    ALGEBRAIC(:,3) = 1.00000./(1.00000+exp((STATES(:,1)+43.0000)./8.90000));
    RATES(:,5) = (ALGEBRAIC(:,3) - STATES(:,5))./CONSTANTS(:,180);
    ALGEBRAIC(:,4) = 1.00000 - 1.00000./(1.00000+exp(((STATES(:,2) - 8.99900e-05) - 0.000214000)./ - 1.31000e-05));
    RATES(:,6) = (ALGEBRAIC(:,4) - STATES(:,6))./CONSTANTS(:,181);
    ALGEBRAIC(:,5) = 1.00000./(1.00000+exp((STATES(:,1)+27.5000)./ - 10.9000));
    RATES(:,7) = (ALGEBRAIC(:,5) - STATES(:,7))./CONSTANTS(:,182);
    ALGEBRAIC(:,9) = 1.00000./(1.00000+exp((STATES(:,1)+27.0000)./ - 5.00000));
    RATES(:,10) = (ALGEBRAIC(:,9) - STATES(:,10))./CONSTANTS(:,189);
    ALGEBRAIC(:,14) = 0.100000+0.900000./(1.00000+exp((STATES(:,1)+65.0000)./6.20000));
    RATES(:,15) = (ALGEBRAIC(:,14) - STATES(:,15))./CONSTANTS(:,192);
    ALGEBRAIC(:,17) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,66))./CONSTANTS(:,67)));
    RATES(:,18) = ((ALGEBRAIC(:,17) - STATES(:,18))./CONSTANTS(:,68)).*0.00100000;
    ALGEBRAIC(:,18) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,69))./CONSTANTS(:,70)));
    RATES(:,19) = ((ALGEBRAIC(:,18) - STATES(:,19))./CONSTANTS(:,71)).*0.00100000;
    ALGEBRAIC(:,19) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,73))./CONSTANTS(:,74)));
    RATES(:,20) = ((ALGEBRAIC(:,19) - STATES(:,20))./CONSTANTS(:,75)).*0.00100000;
    ALGEBRAIC(:,21) = (0.530000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,83))./CONSTANTS(:,84)))+1.00000) - 0.530000;
    RATES(:,22) = ((ALGEBRAIC(:,21) - STATES(:,22))./CONSTANTS(:,85)).*0.00100000;
    ALGEBRAIC(:,22) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,93))./CONSTANTS(:,94)));
    RATES(:,24) = ((ALGEBRAIC(:,22) - STATES(:,24))./CONSTANTS(:,95)).*0.00100000;
    ALGEBRAIC(:,23) = (CONSTANTS(:,98)./(1.00000+exp((STATES(:,3) - CONSTANTS(:,96))./CONSTANTS(:,97)))+1.00000) - CONSTANTS(:,98);
    RATES(:,25) = ((ALGEBRAIC(:,23) - STATES(:,25))./CONSTANTS(:,99)).*0.00100000;
    ALGEBRAIC(:,24) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,101))./CONSTANTS(:,102)));
    RATES(:,26) = ((ALGEBRAIC(:,24) - STATES(:,26))./CONSTANTS(:,103)).*0.00100000;
    ALGEBRAIC(:,25) = (0.300000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,104))./CONSTANTS(:,105)))+1.00000) - 0.300000;
    RATES(:,27) = ((ALGEBRAIC(:,25) - STATES(:,27))./CONSTANTS(:,106)).*0.00100000;
    ALGEBRAIC(:,27) = (CONSTANTS(:,116)./(1.00000+exp((STATES(:,3) - CONSTANTS(:,114))./CONSTANTS(:,115)))+1.00000) - CONSTANTS(:,116);
    RATES(:,29) = ((ALGEBRAIC(:,27) - STATES(:,29))./CONSTANTS(:,117)).*0.00100000;
    ALGEBRAIC(:,28) = ( ( CONSTANTS(:,146).*CONSTANTS(:,175).*CONSTANTS(:,174)+ CONSTANTS(:,144).*CONSTANTS(:,176).*CONSTANTS(:,198)).*STATES(:,17))./( CONSTANTS(:,176).*CONSTANTS(:,175).*(CONSTANTS(:,174)+CONSTANTS(:,198)));
    RATES(:,31) = ( ALGEBRAIC(:,28).*(1.00000 - STATES(:,31)) -  CONSTANTS(:,199).*STATES(:,31)).*0.00100000;
    ALGEBRAIC(:,6) = 1.00000./(1.00000+exp((STATES(:,1)+15.8000)./7.00000));
    ALGEBRAIC(:,30) =  CONSTANTS(:,161).*7.58000.*exp( STATES(:,1).*0.00817000);
    RATES(:,8) = (ALGEBRAIC(:,6) - STATES(:,8))./ALGEBRAIC(:,30);
    ALGEBRAIC(:,8) = ( 0.810000.*power(STATES(:,2).*1000.00, CONSTANTS(:,34)))./(power(STATES(:,2).*1000.00, CONSTANTS(:,34))+power(CONSTANTS(:,35), CONSTANTS(:,34)));
    ALGEBRAIC(:,31) = 1.00000./( 0.0470000.*(STATES(:,2).*1000.00)+1.00000./76.0000);
    RATES(:,9) = (ALGEBRAIC(:,8) - STATES(:,9))./ALGEBRAIC(:,31);
    ALGEBRAIC(:,10) = 0.200000+0.800000./(1.00000+exp((STATES(:,1)+58.0000)./10.0000));
    ALGEBRAIC(:,32) =  CONSTANTS(:,160).*( - 707.000+ 1481.00.*exp((STATES(:,1)+36.0000)./95.0000));
    RATES(:,11) = (ALGEBRAIC(:,10) - STATES(:,11))./ALGEBRAIC(:,32);
    ALGEBRAIC(:,11) = 1.00000./(1.00000+exp((STATES(:,1)+47.0000)./ - 4.80000));
    ALGEBRAIC(:,33) =  CONSTANTS(:,159).*( STATES(:,1).* - 0.0170000.*1.00000+0.440000);
    RATES(:,12) = (ALGEBRAIC(:,11) - STATES(:,12))./ALGEBRAIC(:,33);
    ALGEBRAIC(:,12) = 1.00000./(1.00000+exp((STATES(:,1)+78.0000)./3.00000));
    ALGEBRAIC(:,34) =  CONSTANTS(:,159).*( STATES(:,1).* - 0.250000.*1.00000+5.50000);
    RATES(:,13) = (ALGEBRAIC(:,12) - STATES(:,13))./ALGEBRAIC(:,34);
    ALGEBRAIC(:,13) = 1.00000./(1.00000+exp((STATES(:,1)+26.5000)./ - 7.90000));
    ALGEBRAIC(:,35) =  CONSTANTS(:,160).*(31.8000+ 175.000.*exp(  - 0.500000.*power((STATES(:,1)+44.4000)./22.3000, 2.00000)));
    RATES(:,14) = (ALGEBRAIC(:,13) - STATES(:,14))./ALGEBRAIC(:,35);
    ALGEBRAIC(:,15) = 1.00000./(1.00000+exp((STATES(:,1)+25.0000)./ - 20.0000));
    ALGEBRAIC(:,36) =  (1.00000./(1.00000+exp((STATES(:,1)+66.0000)./ - 26.0000))).*150.000;
    RATES(:,16) = (ALGEBRAIC(:,15) - STATES(:,16))./ALGEBRAIC(:,36);
    ALGEBRAIC(:,38) = 1.00000./(CONSTANTS(:,79)+(CONSTANTS(:,80) - CONSTANTS(:,79))./(1.00000+exp( CONSTANTS(:,81).*(STATES(:,3) - CONSTANTS(:,82)))));
    ALGEBRAIC(:,20) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,77))./CONSTANTS(:,78)));
    RATES(:,21) = ((ALGEBRAIC(:,20) - STATES(:,21))./ALGEBRAIC(:,38)).*0.00100000;
    ALGEBRAIC(:,26) = 1.00000./(1.00000+1.00000./(1.00000+exp( CONSTANTS(:,111).*(STATES(:,3) - CONSTANTS(:,112)))));
    ALGEBRAIC(:,39) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,109))./CONSTANTS(:,110)));
    RATES(:,28) = ((ALGEBRAIC(:,39) - STATES(:,28))./ALGEBRAIC(:,26)).*0.00100000;
    ALGEBRAIC(:,29) =  0.500000.*CONSTANTS(:,164).*log(CONSTANTS(:,8)./STATES(:,2));
    ALGEBRAIC(:,40) =  CONSTANTS(:,17).*STATES(:,5).*STATES(:,4).*STATES(:,6).*(STATES(:,1) - ALGEBRAIC(:,29));
    ALGEBRAIC(:,44) =  0.500000.*CONSTANTS(:,164).*log(CONSTANTS(:,8)./STATES(:,2));
    ALGEBRAIC(:,46) =  CONSTANTS(:,19).*STATES(:,8).*STATES(:,7).*(STATES(:,1) - ALGEBRAIC(:,44));
    ALGEBRAIC(:,42) =  CONSTANTS(:,18).*power( STATES(:,2).*1.00000, 1.34000);
    RATES(:,2) = (  - 1.00000.*ALGEBRAIC(:,40)+  - 1.00000.*ALGEBRAIC(:,46))./( 2.00000.*0.00100000.*CONSTANTS(:,3).*CONSTANTS(:,13))+  - 1.00000.*ALGEBRAIC(:,42);
    ALGEBRAIC(:,58) =  CONSTANTS(:,39).*STATES(:,13).*STATES(:,12).*(STATES(:,1) - CONSTANTS(:,191));
    ALGEBRAIC(:,56) =  CONSTANTS(:,38).*STATES(:,10).*STATES(:,11).*(STATES(:,1) - CONSTANTS(:,190));
    ALGEBRAIC(:,60) =  CONSTANTS(:,40).*STATES(:,14).*STATES(:,15).*(STATES(:,1) - CONSTANTS(:,193));
    ALGEBRAIC(:,48) = 1.00000./(1.00000+exp(STATES(:,1)./ - 17.0000 -  2.00000.*log(STATES(:,2)./0.00100000)));
    ALGEBRAIC(:,50) =  (CONSTANTS(:,20)+CONSTANTS(:,162)).*ALGEBRAIC(:,48).*(STATES(:,1) - CONSTANTS(:,183));
    ALGEBRAIC(:,52) =  CONSTANTS(:,36).*STATES(:,9).*CONSTANTS(:,178).*(STATES(:,1) - CONSTANTS(:,187));
    ALGEBRAIC(:,63) = 1.00000./(1.00000+power(STATES(:,2)./0.000200000,  - 4.00000));
    ALGEBRAIC(:,65) =  CONSTANTS(:,42).*STATES(:,16).*ALGEBRAIC(:,63).*CONSTANTS(:,168).*(STATES(:,1) - CONSTANTS(:,41));
    ALGEBRAIC(:,54) =  CONSTANTS(:,37).*(STATES(:,1) - CONSTANTS(:,188));
    ALGEBRAIC(:,1) =  CONSTANTS(:,16).*(STATES(:,3) - STATES(:,1));
    RATES(:,1) =  ((  - 1.00000.*1.00000)./CONSTANTS(:,12)).*(ALGEBRAIC(:,58)+ALGEBRAIC(:,52)+ALGEBRAIC(:,40)+ALGEBRAIC(:,46)+ALGEBRAIC(:,56)+ALGEBRAIC(:,60)+ALGEBRAIC(:,50)+ALGEBRAIC(:,65)+ALGEBRAIC(:,54)+  - 1.00000.*ALGEBRAIC(:,1));
    ALGEBRAIC(:,16) =  (( CONSTANTS(:,48).*CONSTANTS(:,46))./( CONSTANTS(:,47).*CONSTANTS(:,49))).*log(CONSTANTS(:,53)./STATES(:,17));
    ALGEBRAIC(:,51) = 1.00000./(1.00000+power(STATES(:,23)./CONSTANTS(:,89), CONSTANTS(:,90)));
    ALGEBRAIC(:,53) =  CONSTANTS(:,91).*ALGEBRAIC(:,51).*(STATES(:,3) - ALGEBRAIC(:,16));
    ALGEBRAIC(:,55) = (  - CONSTANTS(:,44).*CONSTANTS(:,92).*ALGEBRAIC(:,53))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
    ALGEBRAIC(:,69) = ( 1.00000e+15.*ALGEBRAIC(:,55).*CONSTANTS(:,194))./CONSTANTS(:,127);
    ALGEBRAIC(:,70) = (((  - CONSTANTS(:,122).*CONSTANTS(:,125)+ALGEBRAIC(:,69)./( 2.00000.* pi.*CONSTANTS(:,173))+ CONSTANTS(:,122).*STATES(:,17)) - ( CONSTANTS(:,123).*CONSTANTS(:,124).*CONSTANTS(:,125))./(CONSTANTS(:,125)+STATES(:,17)))+power((power(( CONSTANTS(:,122).*CONSTANTS(:,125)+ALGEBRAIC(:,69)./( 2.00000.* pi.*CONSTANTS(:,173))+ CONSTANTS(:,122).*STATES(:,17)) - ( CONSTANTS(:,123).*CONSTANTS(:,124).*CONSTANTS(:,125))./(CONSTANTS(:,125)+STATES(:,17)), 2.00000)+ 4.00000.*CONSTANTS(:,122).*CONSTANTS(:,123).*CONSTANTS(:,124).*CONSTANTS(:,125)), 1.0 ./ 2))./( 2.00000.*CONSTANTS(:,122));
    ALGEBRAIC(:,71) =  CONSTANTS(:,128).*( 81.6300.*exp(  - 0.570000.*ALGEBRAIC(:,70))+ 76.1700.*exp(  - 0.0537400.*ALGEBRAIC(:,70)).*exp(STATES(:,3)./( 70.3000.*exp( 0.153000.*ALGEBRAIC(:,70))))).*0.00100000;
    ALGEBRAIC(:,72) = 1.00000./( (1.00000+exp( (CONSTANTS(:,131) - STATES(:,3)).*CONSTANTS(:,132))).*(1.00000+power(ALGEBRAIC(:,70)./( 1.39000.*exp(  - CONSTANTS(:,126).*STATES(:,3))),  - CONSTANTS(:,130))));
    RATES(:,30) = ((ALGEBRAIC(:,72) - STATES(:,30))./ALGEBRAIC(:,71)).*0.00100000;
    ALGEBRAIC(:,75) = ( CONSTANTS(:,135).*power(STATES(:,17), 2.00000))./(power(CONSTANTS(:,134), 2.00000)+power(STATES(:,17), 2.00000));
    ALGEBRAIC(:,76) = power(( CONSTANTS(:,198).*STATES(:,17).*(1.00000 - STATES(:,31)))./( (CONSTANTS(:,198)+CONSTANTS(:,174)).*(STATES(:,17)+CONSTANTS(:,177))), 3.00000);
    ALGEBRAIC(:,77) =  ( CONSTANTS(:,148).*ALGEBRAIC(:,76)+CONSTANTS(:,149)).*(STATES(:,23) - STATES(:,17));
    RATES(:,23) = (( CONSTANTS(:,137).*(ALGEBRAIC(:,75) - ALGEBRAIC(:,77)).*CONSTANTS(:,194))./CONSTANTS(:,172)).*0.00100000;
    ALGEBRAIC(:,37) =  CONSTANTS(:,72).*STATES(:,18).*STATES(:,19).*(STATES(:,3) - ALGEBRAIC(:,16));
    ALGEBRAIC(:,41) = (  - CONSTANTS(:,44).*ALGEBRAIC(:,37))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
    ALGEBRAIC(:,43) =  CONSTANTS(:,76).*STATES(:,20).*(STATES(:,3) - ALGEBRAIC(:,16));
    ALGEBRAIC(:,45) = (  - CONSTANTS(:,44).*ALGEBRAIC(:,43))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
    ALGEBRAIC(:,78) = ( CONSTANTS(:,151).*CONSTANTS(:,152).*STATES(:,17))./(3.60000+STATES(:,17));
    ALGEBRAIC(:,79) = ( CONSTANTS(:,153).*CONSTANTS(:,154).*1.00000)./(1.00000+power(CONSTANTS(:,155)./STATES(:,17), CONSTANTS(:,156)));
    RATES(:,17) = ( CONSTANTS(:,136).*((((ALGEBRAIC(:,77) - ALGEBRAIC(:,75))+ALGEBRAIC(:,55)+ALGEBRAIC(:,41)+ALGEBRAIC(:,45)) - ALGEBRAIC(:,78)) - ALGEBRAIC(:,79))).*0.00100000;
    ALGEBRAIC(:,47) =  CONSTANTS(:,87).*STATES(:,22)+CONSTANTS(:,88);
    ALGEBRAIC(:,49) =  CONSTANTS(:,86).*STATES(:,21).*ALGEBRAIC(:,47).*(STATES(:,3) - CONSTANTS(:,170));
    ALGEBRAIC(:,57) =  CONSTANTS(:,100).*STATES(:,24).*STATES(:,25).*(STATES(:,3) - CONSTANTS(:,171));
    ALGEBRAIC(:,59) =  CONSTANTS(:,107).*STATES(:,26).*STATES(:,27).*(STATES(:,3) - CONSTANTS(:,64));
    ALGEBRAIC(:,62) =  CONSTANTS(:,108).*(STATES(:,3) - CONSTANTS(:,171));
    ALGEBRAIC(:,64) =  CONSTANTS(:,118).*STATES(:,28).*STATES(:,29).*(STATES(:,3) - CONSTANTS(:,171));
    ALGEBRAIC(:,66) = piecewise({VOI.*0.00100000>18.0000&VOI.*0.00100000<18.5000, 0.00000 }, 0.00000);
    ALGEBRAIC(:,67) = power(STATES(:,17), CONSTANTS(:,119))./(power(CONSTANTS(:,120), CONSTANTS(:,119))+power(STATES(:,17), CONSTANTS(:,119)));
    ALGEBRAIC(:,68) =  CONSTANTS(:,121).*(1.00000 - CONSTANTS(:,186)).*ALGEBRAIC(:,67).*(STATES(:,3) - CONSTANTS(:,63));
    ALGEBRAIC(:,73) = ( STATES(:,30).*CONSTANTS(:,185).*1.00000)./(1.00000+power((ALGEBRAIC(:,72) - STATES(:,30))./ALGEBRAIC(:,71), 2.00000));
    ALGEBRAIC(:,74) =  CONSTANTS(:,133).*(STATES(:,30) - ALGEBRAIC(:,73)).*(STATES(:,3) - CONSTANTS(:,169));
    ALGEBRAIC(:,80) =  (( CONSTANTS(:,151).*CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194))./ - CONSTANTS(:,44)).*CONSTANTS(:,92).*ALGEBRAIC(:,78);
    ALGEBRAIC(:,81) =  CONSTANTS(:,157).*(STATES(:,3) - CONSTANTS(:,170));
    ALGEBRAIC(:,82) = ALGEBRAIC(:,53)+ALGEBRAIC(:,74)+ALGEBRAIC(:,37)+ALGEBRAIC(:,62)+ALGEBRAIC(:,81)+ALGEBRAIC(:,49)+ALGEBRAIC(:,43)+ALGEBRAIC(:,68)+ALGEBRAIC(:,80)+ALGEBRAIC(:,57)+ALGEBRAIC(:,64)+ALGEBRAIC(:,59)+ALGEBRAIC(:,66);
    RATES(:,3) = ( - ALGEBRAIC(:,82)./CONSTANTS(:,158)).*0.00100000;
   RATES = RATES';
end

% Calculate algebraic variables
function ALGEBRAIC = computeAlgebraic(ALGEBRAIC, CONSTANTS, STATES, VOI)
    statesSize = size(STATES);
    statesColumnCount = statesSize(2);
    if ( statesColumnCount == 1)
        STATES = STATES';
        utilOnes = 1;
    else
        statesRowCount = statesSize(1);
        utilOnes = ones(statesRowCount, 1);
    end
    ALGEBRAIC(:,2) = 1.00000./(1.00000+exp((STATES(:,1)+17.0000)./ - 4.30000));
    ALGEBRAIC(:,3) = 1.00000./(1.00000+exp((STATES(:,1)+43.0000)./8.90000));
    ALGEBRAIC(:,4) = 1.00000 - 1.00000./(1.00000+exp(((STATES(:,2) - 8.99900e-05) - 0.000214000)./ - 1.31000e-05));
    ALGEBRAIC(:,5) = 1.00000./(1.00000+exp((STATES(:,1)+27.5000)./ - 10.9000));
    ALGEBRAIC(:,9) = 1.00000./(1.00000+exp((STATES(:,1)+27.0000)./ - 5.00000));
    ALGEBRAIC(:,14) = 0.100000+0.900000./(1.00000+exp((STATES(:,1)+65.0000)./6.20000));
    ALGEBRAIC(:,17) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,66))./CONSTANTS(:,67)));
    ALGEBRAIC(:,18) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,69))./CONSTANTS(:,70)));
    ALGEBRAIC(:,19) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,73))./CONSTANTS(:,74)));
    ALGEBRAIC(:,21) = (0.530000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,83))./CONSTANTS(:,84)))+1.00000) - 0.530000;
    ALGEBRAIC(:,22) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,93))./CONSTANTS(:,94)));
    ALGEBRAIC(:,23) = (CONSTANTS(:,98)./(1.00000+exp((STATES(:,3) - CONSTANTS(:,96))./CONSTANTS(:,97)))+1.00000) - CONSTANTS(:,98);
    ALGEBRAIC(:,24) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,101))./CONSTANTS(:,102)));
    ALGEBRAIC(:,25) = (0.300000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,104))./CONSTANTS(:,105)))+1.00000) - 0.300000;
    ALGEBRAIC(:,27) = (CONSTANTS(:,116)./(1.00000+exp((STATES(:,3) - CONSTANTS(:,114))./CONSTANTS(:,115)))+1.00000) - CONSTANTS(:,116);
    ALGEBRAIC(:,28) = ( ( CONSTANTS(:,146).*CONSTANTS(:,175).*CONSTANTS(:,174)+ CONSTANTS(:,144).*CONSTANTS(:,176).*CONSTANTS(:,198)).*STATES(:,17))./( CONSTANTS(:,176).*CONSTANTS(:,175).*(CONSTANTS(:,174)+CONSTANTS(:,198)));
    ALGEBRAIC(:,6) = 1.00000./(1.00000+exp((STATES(:,1)+15.8000)./7.00000));
    ALGEBRAIC(:,30) =  CONSTANTS(:,161).*7.58000.*exp( STATES(:,1).*0.00817000);
    ALGEBRAIC(:,8) = ( 0.810000.*power(STATES(:,2).*1000.00, CONSTANTS(:,34)))./(power(STATES(:,2).*1000.00, CONSTANTS(:,34))+power(CONSTANTS(:,35), CONSTANTS(:,34)));
    ALGEBRAIC(:,31) = 1.00000./( 0.0470000.*(STATES(:,2).*1000.00)+1.00000./76.0000);
    ALGEBRAIC(:,10) = 0.200000+0.800000./(1.00000+exp((STATES(:,1)+58.0000)./10.0000));
    ALGEBRAIC(:,32) =  CONSTANTS(:,160).*( - 707.000+ 1481.00.*exp((STATES(:,1)+36.0000)./95.0000));
    ALGEBRAIC(:,11) = 1.00000./(1.00000+exp((STATES(:,1)+47.0000)./ - 4.80000));
    ALGEBRAIC(:,33) =  CONSTANTS(:,159).*( STATES(:,1).* - 0.0170000.*1.00000+0.440000);
    ALGEBRAIC(:,12) = 1.00000./(1.00000+exp((STATES(:,1)+78.0000)./3.00000));
    ALGEBRAIC(:,34) =  CONSTANTS(:,159).*( STATES(:,1).* - 0.250000.*1.00000+5.50000);
    ALGEBRAIC(:,13) = 1.00000./(1.00000+exp((STATES(:,1)+26.5000)./ - 7.90000));
    ALGEBRAIC(:,35) =  CONSTANTS(:,160).*(31.8000+ 175.000.*exp(  - 0.500000.*power((STATES(:,1)+44.4000)./22.3000, 2.00000)));
    ALGEBRAIC(:,15) = 1.00000./(1.00000+exp((STATES(:,1)+25.0000)./ - 20.0000));
    ALGEBRAIC(:,36) =  (1.00000./(1.00000+exp((STATES(:,1)+66.0000)./ - 26.0000))).*150.000;
    ALGEBRAIC(:,38) = 1.00000./(CONSTANTS(:,79)+(CONSTANTS(:,80) - CONSTANTS(:,79))./(1.00000+exp( CONSTANTS(:,81).*(STATES(:,3) - CONSTANTS(:,82)))));
    ALGEBRAIC(:,20) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,77))./CONSTANTS(:,78)));
    ALGEBRAIC(:,26) = 1.00000./(1.00000+1.00000./(1.00000+exp( CONSTANTS(:,111).*(STATES(:,3) - CONSTANTS(:,112)))));
    ALGEBRAIC(:,39) = 1.00000./(1.00000+exp((STATES(:,3) - CONSTANTS(:,109))./CONSTANTS(:,110)));
    ALGEBRAIC(:,29) =  0.500000.*CONSTANTS(:,164).*log(CONSTANTS(:,8)./STATES(:,2));
    ALGEBRAIC(:,40) =  CONSTANTS(:,17).*STATES(:,5).*STATES(:,4).*STATES(:,6).*(STATES(:,1) - ALGEBRAIC(:,29));
    ALGEBRAIC(:,44) =  0.500000.*CONSTANTS(:,164).*log(CONSTANTS(:,8)./STATES(:,2));
    ALGEBRAIC(:,46) =  CONSTANTS(:,19).*STATES(:,8).*STATES(:,7).*(STATES(:,1) - ALGEBRAIC(:,44));
    ALGEBRAIC(:,42) =  CONSTANTS(:,18).*power( STATES(:,2).*1.00000, 1.34000);
    ALGEBRAIC(:,58) =  CONSTANTS(:,39).*STATES(:,13).*STATES(:,12).*(STATES(:,1) - CONSTANTS(:,191));
    ALGEBRAIC(:,56) =  CONSTANTS(:,38).*STATES(:,10).*STATES(:,11).*(STATES(:,1) - CONSTANTS(:,190));
    ALGEBRAIC(:,60) =  CONSTANTS(:,40).*STATES(:,14).*STATES(:,15).*(STATES(:,1) - CONSTANTS(:,193));
    ALGEBRAIC(:,48) = 1.00000./(1.00000+exp(STATES(:,1)./ - 17.0000 -  2.00000.*log(STATES(:,2)./0.00100000)));
    ALGEBRAIC(:,50) =  (CONSTANTS(:,20)+CONSTANTS(:,162)).*ALGEBRAIC(:,48).*(STATES(:,1) - CONSTANTS(:,183));
    ALGEBRAIC(:,52) =  CONSTANTS(:,36).*STATES(:,9).*CONSTANTS(:,178).*(STATES(:,1) - CONSTANTS(:,187));
    ALGEBRAIC(:,63) = 1.00000./(1.00000+power(STATES(:,2)./0.000200000,  - 4.00000));
    ALGEBRAIC(:,65) =  CONSTANTS(:,42).*STATES(:,16).*ALGEBRAIC(:,63).*CONSTANTS(:,168).*(STATES(:,1) - CONSTANTS(:,41));
    ALGEBRAIC(:,54) =  CONSTANTS(:,37).*(STATES(:,1) - CONSTANTS(:,188));
    ALGEBRAIC(:,1) =  CONSTANTS(:,16).*(STATES(:,3) - STATES(:,1));
    ALGEBRAIC(:,16) =  (( CONSTANTS(:,48).*CONSTANTS(:,46))./( CONSTANTS(:,47).*CONSTANTS(:,49))).*log(CONSTANTS(:,53)./STATES(:,17));
    ALGEBRAIC(:,51) = 1.00000./(1.00000+power(STATES(:,23)./CONSTANTS(:,89), CONSTANTS(:,90)));
    ALGEBRAIC(:,53) =  CONSTANTS(:,91).*ALGEBRAIC(:,51).*(STATES(:,3) - ALGEBRAIC(:,16));
    ALGEBRAIC(:,55) = (  - CONSTANTS(:,44).*CONSTANTS(:,92).*ALGEBRAIC(:,53))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
    ALGEBRAIC(:,69) = ( 1.00000e+15.*ALGEBRAIC(:,55).*CONSTANTS(:,194))./CONSTANTS(:,127);
    ALGEBRAIC(:,70) = (((  - CONSTANTS(:,122).*CONSTANTS(:,125)+ALGEBRAIC(:,69)./( 2.00000.* pi.*CONSTANTS(:,173))+ CONSTANTS(:,122).*STATES(:,17)) - ( CONSTANTS(:,123).*CONSTANTS(:,124).*CONSTANTS(:,125))./(CONSTANTS(:,125)+STATES(:,17)))+power((power(( CONSTANTS(:,122).*CONSTANTS(:,125)+ALGEBRAIC(:,69)./( 2.00000.* pi.*CONSTANTS(:,173))+ CONSTANTS(:,122).*STATES(:,17)) - ( CONSTANTS(:,123).*CONSTANTS(:,124).*CONSTANTS(:,125))./(CONSTANTS(:,125)+STATES(:,17)), 2.00000)+ 4.00000.*CONSTANTS(:,122).*CONSTANTS(:,123).*CONSTANTS(:,124).*CONSTANTS(:,125)), 1.0 ./ 2))./( 2.00000.*CONSTANTS(:,122));
    ALGEBRAIC(:,71) =  CONSTANTS(:,128).*( 81.6300.*exp(  - 0.570000.*ALGEBRAIC(:,70))+ 76.1700.*exp(  - 0.0537400.*ALGEBRAIC(:,70)).*exp(STATES(:,3)./( 70.3000.*exp( 0.153000.*ALGEBRAIC(:,70))))).*0.00100000;
    ALGEBRAIC(:,72) = 1.00000./( (1.00000+exp( (CONSTANTS(:,131) - STATES(:,3)).*CONSTANTS(:,132))).*(1.00000+power(ALGEBRAIC(:,70)./( 1.39000.*exp(  - CONSTANTS(:,126).*STATES(:,3))),  - CONSTANTS(:,130))));
    ALGEBRAIC(:,75) = ( CONSTANTS(:,135).*power(STATES(:,17), 2.00000))./(power(CONSTANTS(:,134), 2.00000)+power(STATES(:,17), 2.00000));
    ALGEBRAIC(:,76) = power(( CONSTANTS(:,198).*STATES(:,17).*(1.00000 - STATES(:,31)))./( (CONSTANTS(:,198)+CONSTANTS(:,174)).*(STATES(:,17)+CONSTANTS(:,177))), 3.00000);
    ALGEBRAIC(:,77) =  ( CONSTANTS(:,148).*ALGEBRAIC(:,76)+CONSTANTS(:,149)).*(STATES(:,23) - STATES(:,17));
    ALGEBRAIC(:,37) =  CONSTANTS(:,72).*STATES(:,18).*STATES(:,19).*(STATES(:,3) - ALGEBRAIC(:,16));
    ALGEBRAIC(:,41) = (  - CONSTANTS(:,44).*ALGEBRAIC(:,37))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
    ALGEBRAIC(:,43) =  CONSTANTS(:,76).*STATES(:,20).*(STATES(:,3) - ALGEBRAIC(:,16));
    ALGEBRAIC(:,45) = (  - CONSTANTS(:,44).*ALGEBRAIC(:,43))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
    ALGEBRAIC(:,78) = ( CONSTANTS(:,151).*CONSTANTS(:,152).*STATES(:,17))./(3.60000+STATES(:,17));
    ALGEBRAIC(:,79) = ( CONSTANTS(:,153).*CONSTANTS(:,154).*1.00000)./(1.00000+power(CONSTANTS(:,155)./STATES(:,17), CONSTANTS(:,156)));
    ALGEBRAIC(:,47) =  CONSTANTS(:,87).*STATES(:,22)+CONSTANTS(:,88);
    ALGEBRAIC(:,49) =  CONSTANTS(:,86).*STATES(:,21).*ALGEBRAIC(:,47).*(STATES(:,3) - CONSTANTS(:,170));
    ALGEBRAIC(:,57) =  CONSTANTS(:,100).*STATES(:,24).*STATES(:,25).*(STATES(:,3) - CONSTANTS(:,171));
    ALGEBRAIC(:,59) =  CONSTANTS(:,107).*STATES(:,26).*STATES(:,27).*(STATES(:,3) - CONSTANTS(:,64));
    ALGEBRAIC(:,62) =  CONSTANTS(:,108).*(STATES(:,3) - CONSTANTS(:,171));
    ALGEBRAIC(:,64) =  CONSTANTS(:,118).*STATES(:,28).*STATES(:,29).*(STATES(:,3) - CONSTANTS(:,171));
    ALGEBRAIC(:,66) = piecewise({VOI.*0.00100000>18.0000&VOI.*0.00100000<18.5000, 0.00000 }, 0.00000);
    ALGEBRAIC(:,67) = power(STATES(:,17), CONSTANTS(:,119))./(power(CONSTANTS(:,120), CONSTANTS(:,119))+power(STATES(:,17), CONSTANTS(:,119)));
    ALGEBRAIC(:,68) =  CONSTANTS(:,121).*(1.00000 - CONSTANTS(:,186)).*ALGEBRAIC(:,67).*(STATES(:,3) - CONSTANTS(:,63));
    ALGEBRAIC(:,73) = ( STATES(:,30).*CONSTANTS(:,185).*1.00000)./(1.00000+power((ALGEBRAIC(:,72) - STATES(:,30))./ALGEBRAIC(:,71), 2.00000));
    ALGEBRAIC(:,74) =  CONSTANTS(:,133).*(STATES(:,30) - ALGEBRAIC(:,73)).*(STATES(:,3) - CONSTANTS(:,169));
    ALGEBRAIC(:,80) =  (( CONSTANTS(:,151).*CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194))./ - CONSTANTS(:,44)).*CONSTANTS(:,92).*ALGEBRAIC(:,78);
    ALGEBRAIC(:,81) =  CONSTANTS(:,157).*(STATES(:,3) - CONSTANTS(:,170));
    ALGEBRAIC(:,82) = ALGEBRAIC(:,53)+ALGEBRAIC(:,74)+ALGEBRAIC(:,37)+ALGEBRAIC(:,62)+ALGEBRAIC(:,81)+ALGEBRAIC(:,49)+ALGEBRAIC(:,43)+ALGEBRAIC(:,68)+ALGEBRAIC(:,80)+ALGEBRAIC(:,57)+ALGEBRAIC(:,64)+ALGEBRAIC(:,59)+ALGEBRAIC(:,66);
    ALGEBRAIC(:,7) = ( CONSTANTS(:,23).*power(STATES(:,2).*1000.00, CONSTANTS(:,22)))./(power(STATES(:,2).*1000.00, CONSTANTS(:,22))+power(CONSTANTS(:,196), CONSTANTS(:,22)));
    ALGEBRAIC(:,61) = (  - CONSTANTS(:,44).*ALGEBRAIC(:,59))./( CONSTANTS(:,49).*CONSTANTS(:,47).*CONSTANTS(:,194));
end

% Compute result of a piecewise function
function x = piecewise(cases, default)
    set = [0];
    for i = 1:2:length(cases)
        if (length(cases{i+1}) == 1)
            x(cases{i} & ~set,:) = cases{i+1};
        else
            x(cases{i} & ~set,:) = cases{i+1}(cases{i} & ~set);
        end
        set = set | cases{i};
        if(set), break, end
    end
    if (length(default) == 1)
        x(~set,:) = default;
    else
        x(~set,:) = default(~set);
    end
end

% Pad out or shorten strings to a set length
function strout = strpad(strin)
    req_length = 160;
    insize = size(strin,2);
    if insize > req_length
        strout = strin(1:req_length);
    else
        strout = [strin, blanks(req_length - insize)];
    end
end

